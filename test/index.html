<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>公式编辑器测试页面</title>
</head>

<body>
  <h2>公式编辑器（IntelliSense）</h2>
  <div>样例：</div>
  <div style="margin:10px 0 10px 0">=IF(C7&lt;E7,MIN(ABS(E7-C7),D7),0)</div>
  <div id="container" style="width:600px;height:38px;border:1px solid grey"></div>
  <script src="/formula-sdk.js"></script>
  <script src="/main.formula-sdk.js"></script>
  <!-- OR ANY OTHER AMD LOADER HERE INSTEAD OF loader.js -->
  <script src="/node_modules/monaco-editor-core/min/vs/loader.js"></script>
  <script>
    require.config({
      paths: {
        'vs': '/node_modules/monaco-editor-core/min/vs'
      }
    });

    require(['vs/editor/editor.main'], function () {
      let langId = 'lang-formula';
      let themeName = langId + '-theme';

      monaco.languages.register({
        id: langId
      });

      monaco.languages.setTokensProvider(langId, new formulaSDK.FormulaTokensProvider());
      let literalFg = '1155cc';

      monaco.editor.defineTheme(themeName, {
        base: 'vs',
        inherit: false,
        rules: [{
            token: 'basicnumberliteral.formula',
            foreground: literalFg
          },
          {
            token: 'unexpectedcharacter.formula',
            foreground: 'ff0000'
          },
          {
            token: 'fnidentifier.formula',
            foreground: '000000'
          },
          {
            token: 'error.formula',
            foreground: 'ff0000'
          }
        ]
      });

      monaco.editor.onDidCreateEditor(function(editor) {
        console.log('created', editor);
      });

      var editor = monaco.editor.create(document.getElementById('container'), {
        value: [
          'IF(C7 <  E7, MIN( ABS(E7 -C7),D7), 0)',
        ].join('\n'),
        language: langId,
        theme: themeName,
        minimap: {
          enabled: false
        },
        autoClosingBrackets: true,
        lineNumbers: false, //隐藏行号
        folding: false //关闭折叠占位符
      });

      monaco.languages.setLanguageConfiguration(langId, {
        brackets: [
          ['{', '}'],
          ['[', ']'],
          ['(', ')']
        ],
        autoClosingPairs: [{
            open: '{',
            close: '}'
          },
          {
            open: '[',
            close: ']'
          },
          {
            open: '(',
            close: ')'
          },
          {
            open: '"',
            close: '"',
            notIn: ['string']
          },
          {
            open: '\'',
            close: '\'',
            notIn: ['string', 'comment']
          },
          {
            open: "/**",
            close: " */",
            notIn: ["string"]
          }
        ]
      });

      formulaSDK.CellAddressTokensDecorator.registerDecorator(editor, monaco);

    });
  </script>
</body>

</html>